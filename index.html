<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Lorentz Decora√ß√µes - App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    :root {
      --bg: #05060b;
      --card: #111320;
      --card2: #181b2a;
      --accent: #ff4f8b;
      --accent-soft: rgba(255, 79, 139, 0.16);
      --text: #f5f7ff;
      --muted: #a4adc4;
      --border: rgba(255, 255, 255, 0.08);
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #151932 0, #05060b 55%);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      flex-direction: column;
    }
    header {
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(90deg, rgba(10,12,25,0.95), rgba(10,7,18,0.95));
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: radial-gradient(circle at 30% 0, #ffd3f0 0, #ff4f8b 30%, #32153f 70%, #05060b 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 18px;
    }
    .brand-text {
      display: flex;
      flex-direction: column;
    }
    .brand-text span:first-child {
      font-weight: 600;
      letter-spacing: 0.03em;
    }
    .brand-text span:last-child {
      font-size: 12px;
      color: var(--muted);
    }

    .user-info {
      font-size: 13px;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--muted);
    }
    .pill {
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 12px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.02);
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 13px;
      cursor: pointer;
      background: var(--accent);
      color: #fff;
      font-weight: 500;
      transition: transform .08s ease, box-shadow .08s ease, background .08s ease;
      box-shadow: 0 8px 20px rgba(255,79,139,0.35);
    }
    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(255,79,139,0.45);
    }
    button.secondary {
      background: transparent;
      color: var(--muted);
      box-shadow: none;
      border: 1px solid var(--border);
    }
    main {
      max-width: 1080px;
      margin: 18px auto 24px;
      padding: 0 16px;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(320px, 1.1fr);
      gap: 18px;
    }
    @media (max-width: 840px) {
      main {
        grid-template-columns: 1fr;
      }
    }
    .card {
      background: radial-gradient(circle at top left, rgba(255,79,139,0.18), transparent 55%);
      border-radius: 20px;
      border: 1px solid var(--border);
      padding: 16px 16px 14px;
      background-color: var(--card);
      box-shadow: 0 18px 45px rgba(0,0,0,0.45);
    }
    .card h2 {
      font-size: 18px;
      margin-bottom: 6px;
    }
    .card p {
      font-size: 13px;
      color: var(--muted);
      margin-bottom: 12px;
    }

    /* Cat√°logo */
    #catalogo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .decor-card {
      background: var(--card2);
      border-radius: 16px;
      border: 1px solid var(--border);
      padding: 10px;
      position: relative;
      overflow: hidden;
    }
    .decor-tag {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 4px;
    }
    .decor-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    .decor-desc {
      font-size: 12px;
      color: var(--muted);
    }

    /* Login / √Årea logada */
    form {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-top: 8px;
    }
    label {
      font-size: 13px;
      color: var(--muted);
    }
    input {
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #050711;
      color: var(--text);
      padding: 8px 10px;
      font-size: 14px;
      outline: none;
    }
    input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(255,79,139,0.35);
    }
    .hint {
      font-size: 11px;
      color: var(--muted);
    }
    .status {
      font-size: 12px;
      margin-top: 6px;
    }
    .status.error { color: #ff8b8b; }
    .status.ok { color: #7affc8; }

    .hidden { display: none !important; }

    .badge-role {
      font-size: 11px;
      padding: 2px 7px;
      border-radius: 999px;
      background: var(--accent-soft);
      color: #ffdbea;
      border: 1px solid rgba(255,79,139,0.4);
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .footer {
      text-align: center;
      font-size: 11px;
      color: var(--muted);
      padding: 10px 0 16px;
      border-top: 1px solid rgba(255,255,255,0.04);
      margin: 0 12px;
    }
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="brand-logo">L&L</div>
    <div class="brand-text">
      <span>L&L Decora√ß√µes</span>
      <span>Casamentos ‚Ä¢ 15 anos ‚Ä¢ Anivers√°rios</span>
    </div>
  </div>
  <div class="user-info">
    <span id="header-session-text">Visitante</span>
    <span id="header-role" class="badge-role hidden"></span>
    <button id="btn-logout" class="secondary hidden">Sair</button>
  </div>
</header>

<main>
  <!-- Coluna esquerda: cat√°logo p√∫blico -->
  <section class="card" id="catalogo-card">
    <h2>Cat√°logo de decora√ß√µes</h2>
    <p>Veja algumas das montagens que j√° realizamos. Seus convidados lembram da festa, mas o cen√°rio fica pra sempre nas fotos.</p>
    <div id="catalogo-grid">
      <!-- itens vir√£o via JS -->
    </div>
    <p class="hint" style="margin-top:10px;">Esses dados v√™m direto do banco Supabase (tabela <code>decoracoes</code>).</p>
  </section>

  <!-- Coluna direita: login / √°rea do cliente & admin -->
  <section class="card" id="auth-card">
    <div id="login-section">
      <h2>√Årea do cliente</h2>
      <p>Acesse com o e-mail e senha cadastrados. O admin usa esse mesmo login para gerenciar contratos.</p>

      <form id="login-form">
        <div>
          <label for="email">E-mail</label>
          <input id="email" type="email" required placeholder="seuemail@exemplo.com">
        </div>
        <div>
          <label for="password">Senha</label>
          <input id="password" type="password" required placeholder="Sua senha">
        </div>
        <button type="submit">Entrar</button>
        <p class="hint">Use o e-mail e senha que voc√™ cadastrou no painel da Supabase.</p>
        <p id="login-status" class="status"></p>
      </form>
    </div>

    <div id="admin-section" class="hidden">
      <h2>Painel do administrador</h2>
      <p class="hint">Aqui depois vamos colocar: cadastro de clientes, contratos, pagamentos, etc.</p>
      <ul style="margin-top:8px;font-size:13px;color:var(--muted);padding-left:18px;">
        <li>Listar clientes e contratos</li>
        <li>Registrar novos eventos</li>
        <li>Controlar pagamentos</li>
      </ul>
    </div>

    <div id="client-section" class="hidden">
      <h2>√Årea do cliente</h2>
      <p class="hint">Aqui depois vamos mostrar o plano contratado, detalhes do evento e situa√ß√£o dos pagamentos.</p>
    </div>
  </section>
</main>

<div class="footer">
  Criado por Richard Alex @richard.gms ‚Ä¢ App L&L Decora√ß√µes (vers√£o base com Supabase)
</div>

<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  const SUPABASE_URL = 'https://tsdrlbkrkjaxzpdxtmoa.supabase.co';       // üîÅ TROCAR
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRzZHJsYmtya2pheHpwZHh0bW9hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIxMjY0NjYsImV4cCI6MjA3NzcwMjQ2Nn0.Jx0ot29QIb2bi-wcTL6T69J6oBHoEFbR237Rtf3MO0g';                   // üîÅ TROCAR

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const catalogoGrid = document.getElementById('catalogo-grid');
  const loginForm = document.getElementById('login-form');
  const loginStatus = document.getElementById('login-status');

  const loginSection = document.getElementById('login-section');
  const adminSection = document.getElementById('admin-section');
  const clientSection = document.getElementById('client-section');

  const headerSessionText = document.getElementById('header-session-text');
  const headerRole = document.getElementById('header-role');
  const btnLogout = document.getElementById('btn-logout');

  function showStatus(message, type = 'ok') {
    loginStatus.textContent = message;
    loginStatus.className = 'status ' + (type === 'error' ? 'error' : 'ok');
  }

  function setLoggedOutUI() {
    loginSection.classList.remove('hidden');
    adminSection.classList.add('hidden');
    clientSection.classList.add('hidden');
    headerSessionText.textContent = 'Visitante';
    headerRole.classList.add('hidden');
    btnLogout.classList.add('hidden');
  }

  function setAdminUI(name) {
    loginSection.classList.add('hidden');
    adminSection.classList.remove('hidden');
    clientSection.classList.add('hidden');
    headerSessionText.textContent = name ? name : 'Administrador';
    headerRole.textContent = 'ADMIN';
    headerRole.classList.remove('hidden');
    btnLogout.classList.remove('hidden');
  }

  function setClientUI(name) {
    loginSection.classList.add('hidden');
    adminSection.classList.add('hidden');
    clientSection.classList.remove('hidden');
    headerSessionText.textContent = name || 'Cliente';
    headerRole.textContent = 'CLIENTE';
    headerRole.classList.remove('hidden');
    btnLogout.classList.remove('hidden');
  }

  async function loadCatalog() {
    const { data, error } = await supabase
      .from('decoracoes')
      .select('id, categoria, titulo, descricao, ativo')
      .eq('ativo', true)
      .order('id', { ascending: false });

    catalogoGrid.innerHTML = '';

    if (error) {
      const div = document.createElement('div');
      div.className = 'decor-card';
      div.innerHTML = '<span class="decor-title">Erro ao carregar cat√°logo</span><p class="decor-desc">'
        + (error.message || '') + '</p>';
      catalogoGrid.appendChild(div);
      return;
    }

    if (!data || data.length === 0) {
      const div = document.createElement('div');
      div.className = 'decor-card';
      div.innerHTML = '<span class="decor-title">Sem decora√ß√µes cadastradas ainda</span><p class="decor-desc">Use o painel admin depois para cadastrar suas produ√ß√µes.</p>';
      catalogoGrid.appendChild(div);
      return;
    }

    for (const deco of data) {
      const card = document.createElement('article');
      card.className = 'decor-card';
      card.innerHTML = `
        <div class="decor-tag">${deco.categoria || 'Evento'}</div>
        <div class="decor-title">${deco.titulo}</div>
        <div class="decor-desc">${deco.descricao || ''}</div>
      `;
      catalogoGrid.appendChild(card);
    }
  }

  async function handleSession(user) {
    if (!user) {
      setLoggedOutUI();
      return;
    }

    const { data: profile, error } = await supabase
      .from('profiles')
      .select('name, role')
      .eq('id', user.id)
      .maybeSingle();

    if (error) {
      console.error('Erro ao carregar profile:', error);
      setLoggedOutUI();
      return;
    }

    const name = profile?.name || user.email;

    if (profile?.role === 'admin') {
      setAdminUI(name);
    } else {
      setClientUI(name);
    }
  }

  loginForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    loginStatus.textContent = '';
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    showStatus('Autenticando...', 'ok');

    const { data, error } = await supabase.auth.signInWithPassword({
      email,
      password
    });

    if (error) {
      console.error(error);
      showStatus('Erro ao entrar: ' + error.message, 'error');
      return;
    }

    const user = data.user;
    if (!user) {
      showStatus('N√£o foi poss√≠vel recuperar o usu√°rio.', 'error');
      return;
    }

    showStatus('Login realizado com sucesso!', 'ok');
    await handleSession(user);
  });

  btnLogout.addEventListener('click', async () => {
    await supabase.auth.signOut();
    setLoggedOutUI();
  });

  // Quando a p√°gina carrega: busca cat√°logo + verifica se j√° tem sess√£o
  (async () => {
    await loadCatalog();

    const { data } = await supabase.auth.getSession();
    const session = data?.session;
    if (session?.user) {
      await handleSession(session.user);
    } else {
      setLoggedOutUI();
    }

    supabase.auth.onAuthStateChange((_event, session) => {
      handleSession(session?.user ?? null);
    });
  })();
</script>
</body>
</html>
